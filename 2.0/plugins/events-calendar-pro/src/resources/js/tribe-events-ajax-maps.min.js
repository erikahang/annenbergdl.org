!function(a,b,c,d,e,f,g,h,j,k){c.extend(tribe_ev.fn,{map_add_marker:function(a,b,d,e,f){var h=new google.maps.LatLng(a,b),i=new google.maps.Marker({position:h,map:g.map,title:d}),j=new google.maps.InfoWindow,k=d;f&&(k=c("<div/>").append(c("<a/>").attr("href",f).text(d)).html());var l=TribeEventsPro.map_tooltip_event+k;e&&(l=l+"<br/>"+TribeEventsPro.map_tooltip_address+e),j.setContent(l),google.maps.event.addListener(i,"click",function(){j.open(g.map,i)}),g.markers.push(i),g.refine&&i.setVisible(!1),g.bounds.extend(h)}}),g.geocoder=new google.maps.Geocoder,g.bounds=new google.maps.LatLngBounds,c(b).ready(function(){function l(){if(c("#tribe-bar-geoloc").length){var a=c("#tribe-bar-geoloc").val(),b=c("#tribe_events_filter_item_geofence"),d=c("#tribe-bar-geoloc-lat, #tribe-bar-geoloc-lng");a.length?b.show():(b.hide(),d.length&&d.val(""))}}function m(){return h.ajax_running=!0,h.params={action:"tribe_geosearch",tribe_paged:h.paged,tribe_event_display:h.view},h.category&&(h.params.tribe_event_category=h.category),d.default_permalinks&&(h.params.hasOwnProperty("post_type")||(h.params.post_type=k.events_post_type),h.params.hasOwnProperty("eventDisplay")||(h.params.eventDisplay="map")),c(e).trigger("tribe_ev_serializeBar"),f.invalid_date_in_params(h.params)?(h.ajax_running=!1,void(w=!0)):(w=!1,h.params=c.param(h.params),void c(e).trigger("tribe_ev_collectParams"))}function n(){h.popping||(m(),h.pushstate=!1,h.initial_load||(h.do_string=!0)),w||(c("#tribe-events-content .tribe-events-loop").tribe_spin(),p(),c.post(GeoLoc.ajaxurl,h.params,function(a){if(c(e).trigger("tribe_ev_ajaxStart").trigger("tribe_ev_mapView_AjaxStart"),f.enable_inputs("#tribe_events_filters_form","input, select"),a.success){h.ajax_running=!1,d.ajax_response={total_count:parseInt(a.total_count),view:a.view,max_pages:a.max_pages,tribe_paged:a.tribe_paged,timestamp:(new Date).getTime()},h.initial_load=!1;var g=c.parseHTML(a.html);c("#tribe-events-content").replaceWith(g),0==a.total_count&&c("#tribe-events-header").hide(),c.each(a.markers,function(a,b){f.map_add_marker(b.lat,b.lng,b.title,b.address,b.link)}),j.pushstate&&(h.page_title=c("#tribe-events-header").data("title"),b.title=h.page_title,h.do_string&&history.pushState({tribe_paged:h.paged,tribe_params:h.params},h.page_title,d.cur_url+"?"+h.params),h.pushstate&&history.pushState({tribe_paged:h.paged,tribe_params:h.params},h.page_title,d.cur_url)),c(e).trigger("tribe_ev_ajaxSuccess").trigger("tribe_ev_mapView_AjaxSuccess"),a.markers.length>0&&q()}}))}function o(a){if("change_view"!=tribe_events_bar_action){if(a.preventDefault(),h.ajax_running)return;h.paged=1,h.view="map",h.popping=!1,f.pre_ajax(j.pushstate?function(){n(null)}:function(){c(e).trigger("tribe_ev_reloadOldBrowser")})}}function p(){if(g.markers){for(i in g.markers)g.markers[i].setMap(null);g.markers.length=0,g.bounds=new google.maps.LatLngBounds}}function q(){g.map.fitBounds(g.bounds),g.map.getZoom()>13&&g.map.setZoom(13)}function r(){c("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").show()}function s(){c("#tribe-events-footer, #tribe-events-header").find(".tribe-events-ajax-loading").hide()}l();var t=c("#tribe-events"),u=c("#tribe-bar-geoloc"),v=c("#tribe-geo-options"),w=!1,x={zoom:5,center:new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng),mapTypeId:google.maps.MapTypeId.ROADMAP};if(b.getElementById("tribe-geo-map")){g.map=new google.maps.Map(b.getElementById("tribe-geo-map"),x),g.bounds=new google.maps.LatLngBounds;var y=new google.maps.LatLng(TribeEventsPro.geocenter.min_lat,TribeEventsPro.geocenter.min_lng);g.bounds.extend(y);var z=new google.maps.LatLng(TribeEventsPro.geocenter.max_lat,TribeEventsPro.geocenter.max_lng);g.bounds.extend(z)}if(c().placeholder&&c("#tribe-geo-location").placeholder(),j.map_view()){var A=f.get_url_param("tribe_paged"),B=f.get_url_param("tribe_event_display");A&&(h.paged=A),h.view="map","past"==B&&(h.view="past"),f.tooltips()}if(j.map_view()&&d.params){var C=d.params;f.in_params(C,"tribe_geosearch")>=0||(C+="&action=tribe_geosearch"),f.in_params(C,"tribe_paged")>=0||(C+="&tribe_paged=1"),h.params=C,h.do_string=!1,h.pushstate=!1,h.popping=!0,f.pre_ajax(function(){n()})}else j.map_view()&&(h.do_string=!1,h.pushstate=!1,h.popping=!1,h.initial_load=!0,f.pre_ajax(function(){n()}));if(j.pushstate&&j.map_view()&&(history.replaceState({tribe_paged:h.paged,tribe_params:h.params},"",location.href),c(a).on("popstate",function(a){var b=a.originalEvent.state;b&&(h.do_string=!1,h.pushstate=!1,h.popping=!0,h.params=b.tribe_params,h.paged=b.tribe_paged,f.pre_ajax(function(){n()}),f.set_form(h.params))})),j.map_view()&&(t.on("click",".tribe-geo-option-link",function(a){a.preventDefault(),a.stopPropagation();var b=c(this);c(".tribe-geo-option-link").removeClass("tribe-option-loaded"),b.addClass("tribe-option-loaded"),u.val(b.text()),c("#tribe-bar-geoloc-lat").val(g.geocodes[b.data("index")].geometry.location.lat()),c("#tribe-bar-geoloc-lng").val(g.geocodes[b.data("index")].geometry.location.lng()),h.do_string=!0,h.pushstate=!1,h.popping=!1,f.pre_ajax(j.pushstate?function(){n(),v.hide()}:function(){c(e).trigger("tribe_ev_reloadOldBrowser")})}),c(b).on("click",function(){v.hide()}),f.snap("#tribe-events-content-wrapper","#tribe-events-content-wrapper","#tribe-events-footer .tribe-events-nav-previous a, #tribe-events-footer .tribe-events-nav-next a")),c(e).on("tribe_ev_reloadOldBrowser",function(){m(),a.location=d.cur_url+"?"+h.params}),j.map_view()){var D;c("#tribe-geo-map-wrapper").resize(function(){D=g.map.getCenter(),google.maps.event.trigger(g.map,"resize"),g.map.setCenter(D)}),c("#tribe-events").on("click","li.tribe-events-nav-next a",function(a){a.preventDefault(),h.ajax_running||("past"===h.view?"1"==h.paged?h.view="map":h.paged--:h.paged++,h.popping=!1,f.pre_ajax(j.pushstate?function(){n()}:function(){c(e).trigger("tribe_ev_reloadOldBrowser")}))}).on("click","li.tribe-events-nav-previous a",function(a){a.preventDefault(),h.ajax_running||("map"===h.view?"1"==h.paged?h.view="past":h.paged--:h.paged++,h.popping=!1,f.pre_ajax(j.pushstate?function(){n(null)}:function(){c(e).trigger("tribe_ev_reloadOldBrowser")}))})}(GeoLoc.map_view&&c("form#tribe-bar-form").length&&j.live_ajax()&&j.pushstate||GeoLoc.map_view&&j.no_bar())&&c("#tribe-events-bar").on("changeDate","#tribe-bar-date",function(a){o(a)}),GeoLoc.map_view&&c(e).on("tribe_ev_runAjax",function(){n()}),j.map_view()&&c("form#tribe-bar-form").on("submit",function(){if("change_view"!=tribe_events_bar_action){h.paged=1,r(),c(".tribe-events-sub-nav").remove();var a=c("#tribe-bar-geoloc").val();return""!==a?(h.do_string=!0,h.pushstate=!1,h.popping=!1,p(),c("#tribe-geo-results").empty(),c("#tribe-geo-options").hide(),c("#tribe-geo-options #tribe-geo-links").empty(),f.process_geocoding(a,function(a){g.geocodes=a,s();var b=a[0].geometry.location.lat(),d=a[0].geometry.location.lng();b&&c("#tribe-bar-geoloc-lat").val(b),d&&c("#tribe-bar-geoloc-lng").val(d),g.geocodes.length>1?(f.print_geo_options(),l(),q()):j.pushstate?(l(),n(g.geocodes[0])):c(e).trigger("tribe_ev_reloadOldBrowser")}),!1):""===a?(c("#tribe-bar-geoloc-lat").val(""),c("#tribe-bar-geoloc-lng").val(""),c("#tribe-geo-options").hide(),j.pushstate?(h.do_string=!0,h.pushstate=!1,h.popping=!1,l(),n()):c(e).trigger("tribe_ev_reloadOldBrowser"),s(),!1):!0}})})}(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.geoloc,tribe_ev.state,tribe_ev.tests,tribe_js_config,tribe_debug);